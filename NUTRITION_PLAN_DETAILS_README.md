# Nutrition Plan Details Feature

تم إضافة صفحة تفاصيل خطة التغذية مع إمكانية عرض الخطط للمرضى وتشجيعهم على الاشتراك.

## الميزات المضافة

### 1. صفحة تفاصيل خطة التغذية (`/nutrition/plan/:id`)

**الملفات المضافة:**
- `/frontend/src/pages/NutritionPlanDetails.jsx` - صفحة التفاصيل الكاملة
- `/frontend/src/components/ui/badge.jsx` - مكون Badge للعلامات

**الميزات:**
- عرض معلومات المريض (العمر، الجنس، الوزن، الطول)
- عرض مستوى النشاط والهدف
- عرض الحالات الصحية مع تأثيرها على السعرات
- عرض المتطلبات الحرارية (BMR, TDEE, Target Calories)
- تفصيل المغذيات الكبرى (البروتين، الكربوهيدرات، الدهون) مع نسب مئوية
- عرض خطة الوجبات (إذا كانت متوفرة)
- عرض الملاحظات والحساسيات والأدوية

### 2. تحسينات صفحة التغذية الرئيسية

**التحسينات:**
- ربط زر "View Details" بصفحة التفاصيل
- إضافة إشعارات الاشتراك للمرضى غير المشتركين
- عرض عدد الحالات الصحية في كل خطة
- تحسين تصميم بطاقات الخطط

### 3. تكامل نظام الاشتراك

**للمرضى غير المشتركين:**
- إشعار في أعلى قسم الخطط يشجع على الاشتراك
- أزرار اشتراك في بطاقات الخطط
- رسالة تشجيعية عند عدم وجود خطط

## كيفية الاستخدام

### للأطباء:
1. إنشاء خطة تغذية باستخدام الحاسبة
2. الضغط على "View Details" لعرض التفاصيل الكاملة
3. استخدام أزرار التحرير وإرسال WhatsApp (قريباً)
4. تحميل الخطة كـ PDF (قريباً)

### للمرضى:
1. عرض الخطط المخصصة لهم
2. الضغط على "View Details" لعرض التفاصيل
3. إذا لم يكونوا مشتركين، سيرون دعوات للاشتراك
4. يمكنهم الاشتراك للحصول على ميزات إضافية

## الملفات المحدثة

### Frontend:
- `src/pages/NutritionPlan.jsx` - إضافة ربط التفاصيل ونظام الاشتراك
- `src/pages/NutritionPlanDetails.jsx` - صفحة التفاصيل الجديدة
- `src/components/ui/badge.jsx` - مكون Badge جديد
- `src/App.js` - إضافة المسار الجديد
- `src/lib/api.js` - يحتوي على API للحصول على تفاصيل الخطة

### Backend:
- `apps/nutrition/views.py` - تحديث NutritionPlanDetailView لإرجاع البيانات بالتنسيق الصحيح
- `apps/nutrition/urls.py` - يحتوي على المسار للتفاصيل
- `apps/nutrition/serializers.py` - يحتوي على serializers للبيانات

## اختبار الميزات

### 1. اختبار API:
```bash
cd /Users/mohsen/Desktop/Clinical_Nutrition_Platform/backend
python test_plan_details.py
```

### 2. اختبار الواجهة الأمامية:
1. تشغيل الخادم الخلفي: `python manage.py runserver`
2. تشغيل الواجهة الأمامية: `npm start`
3. تسجيل الدخول كطبيب أو مريض
4. الذهاب إلى `/nutrition`
5. إنشاء خطة تغذية أو عرض خطة موجودة
6. الضغط على "View Details"

## الميزات القادمة

- **تحرير الخطط**: إمكانية تحرير الخطط الموجودة
- **تكامل WhatsApp**: إرسال الخطط عبر WhatsApp
- **تحميل PDF**: تحميل الخطط كملفات PDF
- **خطط الوجبات المفصلة**: إضافة وجبات محددة مع الأطعمة والكميات
- **تتبع التقدم**: متابعة تطبيق الخطة والنتائج

## ملاحظات تقنية

### أمان البيانات:
- التحقق من الصلاحيات: المرضى يمكنهم رؤية خططهم فقط
- الأطباء يمكنهم رؤية الخطط التي أنشؤوها
- حماية API بـ JWT tokens

### تصميم متجاوب:
- الصفحة تعمل على جميع أحجام الشاشات
- تخطيط مرن للأعمدة
- أيقونات وألوان واضحة

### تجربة المستخدم:
- رسائل تحميل أثناء جلب البيانات
- رسائل خطأ واضحة
- تنقل سهل مع أزرار العودة
- تصميم بديهي ومنظم
